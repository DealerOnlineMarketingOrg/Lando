<!DOCTYPE html>
<html>
    <head>
        <title>Post testimonial</title>
        <script type="text/javascript" charset="utf-8" src="PhoneGap.js"></script>
        <script type="text/javascript" charset="utf-8" src="CameraAvailable.js"></script>
        <script type="text/javascript" charset="utf-8">
        // The asyncBlock javascript.
            
            // async functions allow for timing async functionality within blocks.
            // asyncReferences holds the number of active async references for async blocks.
            var asyncReferences = 0;
            
            // asyncBlockAdd should be called right before an async function, adding it
            //  to the async block.
            function asyncBlockAdd() {
                asyncReferences++;
            }
            
            // asyncBlockComplete should be called at the end of any success or error async functions.
            function asyncBlockComplete() {
                asyncReferences--;
            }
            
            // asyncBlockStart needs to be called at the beginning of a timed async block.
            // Clears reference count.
            function asyncBlockStart() {
                asyncReferences = 0;
            }
            
            // asyncBlockWait needs to be called at the end of the async block.
            // Won't return until all async references have been returned.
            // Allows a callback function to be passed in. Calls callback on:
            //   1) starting the Wait. 2) when reference async has returned. 3) on completion.
            // Sends an object to the callback with:
            //  total = total number of references for this block.
            //  left = number of references that are left to be finished.
            // Made for loader updating.
            asyncBlockWait(asyncBlockCallback = false) {
                asyncData = {
                    total: asyncReferences,
                    left: asyncReferences,
                }
                
                // Call the first.
                if (asyncBlockCallback)
                    asyncBlockCallback(asyncData);
                
                lastReferenceCount = asyncReferences;
                while (asyncReferences > 0) {
                    if (asyncReferences < lastReferenceCount) {
                        // One reference finished. Run callback.
                        if (asyncBlockCallback)
                            asyncBlockCallback(asyncData);
                        lastReferenceCount = asyncReferences;
                    }
                }
            }
            
            // Used by asyncBlockRun to keep track of reference state.
            asyncReferencesLast = 0;
            
            // asyncBlockRun runs the async block, and exits immediately.
            // Acts as an asynchronous version of asyncBlockWait.
            // Callback works the same was as in asyncBlockWait.
            asyncBlockRun(asyncBlockCallback = false) {
                setInterval(asyncBlockTimer, 100);
            }
            
            // The timer-based call function for asyncBlockRun.
            // Checked every interval for asyncReferences updates,
            //  and calls callback if needed.
            asyncBlockTimer(asyncBlockCallback = false) {
                if (asyncReferences < lastReferenceCount) {
                    // One reference finished. Run callback.
                    if (asyncBlockCallback)
                        asyncBlockCallback(asyncData);
                    lastReferenceCount = asyncReferences;
                }
                // TODO: finish
            }
            
        </script>
        
        <script type="text/javascript" charset="utf-8">
        // Capabilities javascript.
        
            // Checks if there's an network connection. Returns true if one is active, else false.
            function checkNetworkConnection() {
                var networkState = navigator.network.connection.type;
                if (networkState == Connection.NONE)
                    return false;
                else
                    return true;
            }
            
            // Camera
            // Checks camera functionality.
            // Returns true if camera is useable, else false.
            function checkCamera(&ret) {
                asyncBlockAdd();
                // Uses CameraAvailable plugin.
                window.plugins.CameraAvailable.hasCamera(
                    function(result) {
                        // Success.
                        if(result.available) {
                            ret = true;
                            asyncBlockComplete();
                        // Error.
                        } else {
                            ret = false;
                            asyncBlockComplete();
                        }
                    }
                );
            }
            
            // Checks geotagging functionality.
            // Returns true if geotagging can happen, else false.
            function checkGeotagging(&ret) {
                // Attempt to get location.
                // If we time out, report that we don't have geotagging ability.
                // Timeout set for 5 seconds to give it time to find geolocation signal.
                var options = { timeout: 5000};
                asyncBlockAdd();
                navigator.geolocation.getCurrentPosition(
                    // Success
                    function() {
                        ret = true;
                        asyncBlockComplete();
                    },
                    // Error
                    function() {
                        ret = false;
                        asyncBlockComplete();
                    },
                    options
                );
            }
            
            // Twitter
            // Checks Twitter functionality.
            // Returns true if twitter is availiable, else false.
            function checkTwitter() {
                
            }
            
            // Facebook
            // Checks Facebook functionality.
            // Returns true if facebook is availiable, else false.
            function checkFacebook() {
            
            }
            
        </script>
        
        <script type="text/javascript" charset="utf-8">
            // PhoneGap is connecting to device.
            // Calls onDeviceReady function to start.
            document.addEventListener("deviceready", onDeviceReady, false);
            
            // This is a list of capabilities on this device.
            // Set at load.
            var capabilities {network: false, camera:false, geotagging:false, twitter:false, facebook:false};
            
            // Set these to the next and previous functions for each view.
            // Callbacks.
            var prevFunction;
            var nextFunction;
            
            function onDeviceReady() {
                doSplashView();
            }
            
            function doSplashView() {
                var ret;
                
                // Check network status.
                capabilities.network = checkNetworkConnection();
                
                // Start this async block.
                // This block checks for various capabilities of this device.
                // We place it in a block to let the device determine what async
                //  to run, when.
                asyncBlockStart();
                
                    // Check for camera.
                    checkCamera(capabilities.camera);
                    // Check for geolocation capability and availiability.
                    checkGeotagging(capabilities.geotagging);
                    // Check for twitter.
                    checkTwitter(capabilities.twitter);
                    // Check for facebook.
                    checkFacebook(capabilities.facebook);
                
                // Wait until everything in this block is done.
                asyncBlockWait();
                
                prevFunction = false;
                nextFunction = doGetAnnotationView;
                changeView('splash', 'viewGetPic');
            }
            
            function doGetPicView() {
            
                prevFunction = false;
                nextFunction = doGetAnnotationView;
            }
            
            function doGetAnnotationView() {
            
                prevFunction = doGetPicView;
                nextFunction = doGetSocialListView;
            }
            
            function doGetSocialListView() {
            
                prevFunction = doGetAnnotationView;
                nextFunction = doAnotherView;
            }
            
            function doAnotherView() {
            
                prevFunction = doGetSocialListView;
                nextFunction = doGetPicView;
            }
            
            // Gets a picture, annotates it, posts it to social media.
            function createTestimonial() {
                navigator.camera.getPicture(
                    // We got picture!
                    function() {
                        // Ready picture for posting.
                        cameraPic.src = "data:image/jpeg;base64," + data;
                        // Get annotation.
                        annotation = annotateImage();
                        navigator.geolocation.getCurrentPosition(
                            // We got position!
                            function () {
                                // Ready picture with annotation for posting.
                                postToSocial(data);
                            },
                            // We don't have location.
                            function() {
                                // Ready picture with annotation for posting.
                                postToSocial(data);
                            },
                        );
                    },
                    // No picture.
                    function() {
                        // We didn't get picture. We can't do this.
                        window.alert("Taking the picture was cancelled. Nothing will be posted.");
                    },
                    ,null,{sourceType:1,quality:60}
                );
            }
            
            // Annotate ima
            function annotateImage() {
                var annotation = prompt("Enter tag text for photo.","Annotate");
                return annotation;
            }
            
            function postToSocial(data) {
                postToTwitter(data);
                postToFacebook(data);
            }
            
            // Lets the user take a picture.
            // Returns the image taken, else false if cancelled.
            function takePicture() {
                options = { sourceType:1, quality:60 }
                asyncBlockAdd();
                navigator.camera.getPicture(
                    // Success
                    function () {
                    
                    asyncBlockComplete();
                    },
                    // Error
                    function() {
                    
                    asyncBlockComplete();
                    },
                    options
                );
            }
            
            // Returns the current geolocation, or false if failed.
            function getGeoLocation(&ret) {
                // Start async wait.
                waitStateStart
                // Get current geolocation.
                navigator.geolocation.getCurrentPosition(
                    // Success
                    function(data) {
                        waitState = waitStates.complete;
                        ret = data;
                    },
                    // Error
                    function() {
                        waitState = waitStates.complete;
                        ret = false;
                    }
                );
            }
            
            // Sends a post to twitter.
            // Returns true if successful, else false.
            function postToTwitter(data) {
                
            }
            
            // Sends a post to Facebook.
            // Returns true if successful, else false.
            function postToFacebook(data) {
                
            }
            
            </script>
        </head>
    <body>
        
        <div id="splash" class="splash">
            
        </div>
        <div id="viewGetPic" class="splash">
            <h2>Post Testimonial</h2>
            <input type="button" id="btnGetPic" text="Get Picture">
        </div>
        <div id="viewGetTestimonial" class="view">
            <img id="lrgThumb" src="">
            <input type="textarea" id="taTestimonial">
            <label class="subText">Testimonial</label>
            <input type="button" id="btnBackToGetPic" text="Back">
            <input type="button" id="btnSelectSites" text="Select Sites to Post to">
        </div>
        <div id="viewGetSocialList" class="view">
            <imd id="smlThumb" src="" style="float:right">
            <label class="previewText"></label>
            <input type="button" id="btnBackToGetTestimonal" text="Back">
            <input type="button" id="btnPost" text="Post">
        </div>
        <div id="viewSuccess" class="view">
            <h2>Success!</h2>
            <input type="button" id="btnDoAnother" text="Add Another Testimonial">
        </div>
        
    </body>
    
    <script type="text/javascript" charset="utf-8">
        function changeView(oldView, newView) {
            $(oldView).hide('view', {direction: 'left'}, 1000);
            $(newView).show('view', {direction: 'left'}, 1000-$(newView).attr('width'));
        }
        
        $("#btnGetPic").click(function() {
        
        }
        
        $("#btnBackToGetPic").click(function() {
        
        }
        
        $("#btnSelectSites").click(function() {
        
        }
        
        $("#btnBackToGetTestimonal").click(function() {
        
        }
        
        $("#btnPost").click(function() {
        
        }
        
        $("#btnDoAnother").click(function() {
        
        }
    </script>
</html>


















